#include <wiringPi.h>
#include <softPwm.h>
#include <stdio.h>

#define IN1_PIN 24
#define IN2_PIN 23
#define EN_PIN 25

void startMotor(int direction);
void setSpeed(int speed);
void stopMotor();

int main(void) {
    if (wiringPiSetup() == -1) {
        fprintf(stderr, "Error initializing WiringPi\n");
        return 1;
    }

    pinMode(IN1_PIN, OUTPUT);
    pinMode(IN2_PIN, OUTPUT);
    pinMode(EN_PIN, PWM_OUTPUT);

    digitalWrite(IN1_PIN, LOW);
    digitalWrite(IN2_PIN, LOW);
    softPwmCreate(EN_PIN, 0, 100);

    printf("\n");
    printf("The default speed of the motor is LOW & Forward.....\n");
    printf("r-run l-low h-high e-exit\n");
    printf("\n");

    while (1) {
        char x;
        scanf(" %c", &x);

        if (x == 'r') {
            startMotor(1);
        } else if (x == 'l') {
            setSpeed(25);
        } else if (x == 'h') {
            setSpeed(75);
        } else if (x == 'e') {
            stopMotor();
            printf("GPIO Clean up\n");
            return 0;
        } else {
            printf("<<< wrong data >>>\n");
            printf("please enter the defined data to continue.....\n");
        }
    }

    return 0;
}

void startMotor(int direction) {
    if (direction == 1) {
        digitalWrite(IN1_PIN, HIGH);
        digitalWrite(IN2_PIN, LOW);
        printf("Forward\n");
    }
}

void setSpeed(int speed) {
    softPwmWrite(EN_PIN, speed);
    printf("Speed set to %d%%\n", speed);
}

void stopMotor() {
    digitalWrite(IN1_PIN, LOW);
    digitalWrite(IN2_PIN, LOW);
    softPwmWrite(EN_PIN, 0);
    printf("Motor stopped\n");
}
